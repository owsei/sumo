<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cesium</title>

  <!--LIBRERIA TRASFORMACION GEOLOCALIZACION-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>

  <!--CESIUM-->
  <script src="https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.129/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  
  <!--BOOTSTRAP-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- <link rel="stylesheet" href="styles/styles.css"></script> -->
  <style>
   
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  
  <script type="module">
    window.googleTileset = null;
    window.google=false;
    const pinBuilder = new Cesium.PinBuilder();
    window.layerFeaturesInMap=[];

    // window.is3D = true;
    document.getElementById("cesiumContainer").style.display = "block";

    // Inicializar Cesium
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3YWQ3ZWY4ZS03NzBjLTRjNzktYTYyNy0zMTRkYmE1NmE1NDciLCJpZCI6MjgwODk3LCJpYXQiOjE3NDEwNzIzMzl9.rpQ6pVt0APCbZ_zhTJkhquCVXwmMo3unuk4ZafCea-k'; // Usa tu token de Cesium o deja en blanco si es local


    //Terreno de cesium
    window.viewer = new Cesium.Viewer("cesiumContainer", {
        terrain: Cesium.Terrain.fromWorldTerrain({
          // geocoder: true,
          // homeButton: true,
          // sceneModePicker: true,
          // navigationHelpButton: true,
          // navigationInstructionsInitiallyVisible: true,
        }),
    });

    viewer.imageryLayers

    window.baseLayer=[];

    const imageryLayers = viewer.imageryLayers;

    //borrado de capas base
    // viewer.imageryLayers.removeAll(); 
    // Añadir OpenStreetMap como capa base
    
   

    viewer.scene.globe.enableLighting = true;
    window.viewer.scene.skyAtmosphere.show = false;


    // window.googleTileset = await Cesium.createGooglePhotorealistic3DTileset({
    //   onlyUsingWithGoogleGeocoder: true,
    // });
    // viewer.scene.primitives.add(googleTileset);

    function puntoPamplona() {
      viewer.camera.setView({
        destination: Cesium.Cartesian3.fromDegrees(-1.6756, 42.7415, 6500),
        orientation: {
          heading: Cesium.Math.toRadians(10.0),
          pitch: Cesium.Math.toRadians(-40.0),
          roll: 0.0,
        },
      });
    }

    // Muestra CZML de ejemplo (si no se carga nada)
    const sampleCzml = [
      { id: 'document', name: 'Sample CZML', version: '1.0' },
      {
        id: 'vehicle_1',
        name: 'Vehículo ejemplo',
        availability: '2025-10-15T00:00:00Z/2025-10-15T00:00:30Z',
        position: {
          epoch: '2025-10-15T00:00:00Z',
          cartographicDegrees: [
            0, -1.658251,42.807485, 500,
            10, -1.6480, 42.8150, 500,
            20, -1.6475, 42.8158, 500
          ]
        },
        model: {
          uri: "Coches/CocheRojo.glb",
          scale:50,
          // heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND, // Úsalo si el punto está en terreno
          // disableDepthTestDistance: Number.POSITIVE_INFINITY,
        },
        point: { pixelSize: 8, color: { rgba: [255, 0, 0, 255] } },
        path: { show: true, leadTime: 0, trailTime: 60 }
      }
    ];


    let czmlSample = new Cesium.CzmlDataSource.load(sampleCzml);
    viewer.dataSources.add(czmlSample);
    viewer.zoomTo(czmlSample);

    // Carga CZML por defecto
    // let czmlDataSource = new Cesium.CzmlDataSource();
    // viewer.dataSources.add(czmlDataSource);
    // console.log("Cargando czml_3Dmodels_sample.czml");
    // czmlDataSource.load("czml_3Dmodels_sample.czml").then(() => {
    //   console.log("CZML cargado");
    //   viewer.zoomTo(czmlDataSource);
    // });

    // let czmlDataSource = new Cesium.CzmlDataSource.load("./czml_3Dmodels_sample.czml");
    // puntoPamplona();

    // const position = Cesium.Cartesian3.fromDegrees( -1.658251,42.807485);

    //  viewer.entities.add({
    //   position: position,
    //   // orientation: orientation,
    //   model: {
    //     uri: "Coches/CocheRojo.glb", // Asegúrate de que el nombre del archivo coincida con el nombre del objeto
    //     scale:50,
    //     // minimumPixelSize: 100,
    //     // minimumScale: 100,
    //     // maximumScale: 100,
    //     heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND, // Úsalo si el punto está en terreno
    //     disableDepthTestDistance: Number.POSITIVE_INFINITY, // Siempre visible encima del terreno
    //   },
    // });

    viewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees( -1.658251,42.807485, 500),
    });
    
    </script>

</body>
</html>
